{
  "builders": [
    {
      "accelerator": "kvm",
      "boot_wait": "3s",
      "boot_command": [
        "<enter>",
        "<wait30>",
        "<leftShiftOn><f10><leftShiftOff>",
        "<wait5>",
        "setup /unattend:e:\\autounattend.xml<enter>"
      ],
      "communicator": "winrm",
      "cd_files": [
        "{{user `autounattend`}}",
        "./scripts/enable-winrm.ps1",
        "./scripts/sysprep.bat",
        "./scripts/unattend.xml",
        "/mnt/virtio/virtio-win-guest-tools.exe",
        "/mnt/virtio/Balloon/2k22/amd64/balloon.cat",
        "/mnt/virtio/Balloon/2k22/amd64/balloon.inf",
        "/mnt/virtio/Balloon/2k22/amd64/balloon.sys",
        "/mnt/virtio/Balloon/2k22/amd64/blnsvr.exe",
        "/mnt/virtio/fwcfg/2k22/amd64/fwcfg.cat",
        "/mnt/virtio/fwcfg/2k22/amd64/fwcfg.inf",
        "/mnt/virtio/fwcfg/2k22/amd64/fwcfg.sys",
        "/mnt/virtio/NetKVM/2k22/amd64/netkvm.cat",
        "/mnt/virtio/NetKVM/2k22/amd64/netkvmco.exe",
        "/mnt/virtio/NetKVM/2k22/amd64/netkvm.inf",
        "/mnt/virtio/NetKVM/2k22/amd64/netkvmp.exe",
        "/mnt/virtio/NetKVM/2k22/amd64/netkvm.sys",
        "/mnt/virtio/NetKVM/2k22/amd64/Readme.md",
        "/mnt/virtio/pvpanic/2k22/amd64/pvpanic.cat",
        "/mnt/virtio/pvpanic/2k22/amd64/pvpanic.inf",
        "/mnt/virtio/pvpanic/2k22/amd64/pvpanic-pci.cat",
        "/mnt/virtio/pvpanic/2k22/amd64/pvpanic-pci.inf",
        "/mnt/virtio/pvpanic/2k22/amd64/pvpanic.sys",
        "/mnt/virtio/qemufwcfg/2k22/amd64/qemufwcfg.cat",
        "/mnt/virtio/qemufwcfg/2k22/amd64/qemufwcfg.inf",
        "/mnt/virtio/qemupciserial/2k22/amd64/qemupciserial.cat",
        "/mnt/virtio/qemupciserial/2k22/amd64/qemupciserial.inf",
        "/mnt/virtio/smbus/2k22/amd64/smbus.cat",
        "/mnt/virtio/smbus/2k22/amd64/smbus.inf",
        "/mnt/virtio/sriov/2k22/amd64/vioprot.cat",
        "/mnt/virtio/sriov/2k22/amd64/vioprot.inf",
        "/mnt/virtio/viofs/2k22/amd64/viofs.cat",
        "/mnt/virtio/viofs/2k22/amd64/viofs.inf",
        "/mnt/virtio/viofs/2k22/amd64/viofs.sys",
        "/mnt/virtio/viofs/2k22/amd64/virtiofs.exe",
        "/mnt/virtio/viogpudo/2k22/amd64/vgpusrv.exe",
        "/mnt/virtio/viogpudo/2k22/amd64/viogpuap.exe",
        "/mnt/virtio/viogpudo/2k22/amd64/viogpudo.cat",
        "/mnt/virtio/viogpudo/2k22/amd64/viogpudo.inf",
        "/mnt/virtio/viogpudo/2k22/amd64/viogpudo.sys",
        "/mnt/virtio/vioinput/2k22/amd64/viohidkmdf.sys",
        "/mnt/virtio/vioinput/2k22/amd64/vioinput.cat",
        "/mnt/virtio/vioinput/2k22/amd64/vioinput.inf",
        "/mnt/virtio/vioinput/2k22/amd64/vioinput.sys",
        "/mnt/virtio/viomem/2k22/amd64/viomem.cat",
        "/mnt/virtio/viomem/2k22/amd64/viomem.inf",
        "/mnt/virtio/viomem/2k22/amd64/viomem.sys",
        "/mnt/virtio/viorng/2k22/amd64/viorng.cat",
        "/mnt/virtio/viorng/2k22/amd64/viorng.inf",
        "/mnt/virtio/viorng/2k22/amd64/viorng.sys",
        "/mnt/virtio/viorng/2k22/amd64/viorngum.dll",
        "/mnt/virtio/vioscsi/2k22/amd64/vioscsi.cat",
        "/mnt/virtio/vioscsi/2k22/amd64/vioscsi.inf",
        "/mnt/virtio/vioscsi/2k22/amd64/vioscsi.sys",
        "/mnt/virtio/vioserial/2k22/amd64/vioser.cat",
        "/mnt/virtio/vioserial/2k22/amd64/vioser.inf",
        "/mnt/virtio/vioserial/2k22/amd64/vioser.sys",
        "/mnt/virtio/viostor/2k22/amd64/viostor.cat",
        "/mnt/virtio/viostor/2k22/amd64/viostor.inf",
        "/mnt/virtio/viostor/2k22/amd64/viostor.sys"
      ],
      "cd_label": "AUTOUNATTEND",
      "cpus": 4,
      "disk_size": "{{user `disk_size`}}",
      "efi_boot": true,
      "headless": false,
      "iso_checksum": "{{user `iso_checksum`}}",
      "iso_url": "{{user `iso_url`}}",
      "machine_type": "q35",
      "memory": "{{user `memory`}}",
      "output_directory": "{{ user `build_directory` }}",
      "shutdown_command": "e:/sysprep.bat",
      "type": "qemu",
      "vm_name": "{{ user `vm_name` }}",
      "vtpm": true,
      "winrm_password": "packer",
      "winrm_timeout": "{{user `winrm_timeout`}}",
      "winrm_username": "packer"
    }
  ],
  "variables": {
    "autounattend": "./scripts/autounattend.xml",
    "build_directory": "build",
    "disk_size": "61440",
    "disk_type_id": "1",
    "memory": "4096",
    "headless": "false",
    "iso_checksum": "sha256:d0ef4502e350e3c6c53c15b1b3020d38a5ded011bf04998e950720ac8579b23d",
    "iso_url": "https://software-static.download.prss.microsoft.com/dbazure/888969d5-f34g-4e03-ac9d-1f9786c66749/26100.1742.240906-0331.ge_release_svc_refresh_SERVER_EVAL_x64FRE_en-us.iso",
    "manually_download_iso_from": "https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2025",
    "restart_timeout": "5m",
    "virtio_win_iso": "./virtio-win.iso",
    "winrm_timeout": "2h",
    "vm_name": "win2k22",
    "vmx_version": "14"
  }
}
